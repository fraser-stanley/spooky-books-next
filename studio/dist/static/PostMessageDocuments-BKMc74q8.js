import{r as f,a as w,aq as R,cN as P,c6 as S,cO as I,cR as m,cS as D,cT as O,cU as N}from"./sanity-CpqbEnvM.js";const T=n=>{const e=w.c(14),{comlink:t,perspective:d}=n;let a;e[0]!==d?(a=I(d)?P:{apiVersion:S},e[0]=d,e[1]=a):a=e[1];const s=R(a);let c,o;e[2]!==s||e[3]!==t?(c=()=>{const i=s.listen('*[!(_id in path("_.**"))]',{},{effectFormat:"mendoza",events:["welcome","mutation","reconnect"],includePreviousRevision:!1,includeResult:!1,includeAllVersions:!0,tag:"presentation-documents",visibility:"transaction"}).pipe(m(x)),y=i.pipe(m(A),D({bufferSize:1,refCount:!1})),b=t.on("visual-editing/snapshot-welcome",async()=>({event:await new Promise(v=>{y.pipe(O()).subscribe(h=>{v(h)})})})),E=i.pipe(m(C)),_=i.pipe(m(V)),g=N(y,_,E).subscribe(v=>{t.post("presentation/snapshot-event",{event:v})});return()=>{b(),g.unsubscribe()}},o=[s,t],e[2]=s,e[3]=t,e[4]=c,e[5]=o):(c=e[4],o=e[5]),f.useEffect(c,o);let r,u;e[6]!==s||e[7]!==t?(r=()=>t.on("visual-editing/fetch-snapshot",async i=>({snapshot:await s.getDocument(i.documentId,{tag:"document.snapshots"})})),u=[s,t],e[6]=s,e[7]=t,e[8]=r,e[9]=u):(r=e[8],u=e[9]),f.useEffect(r,u);let p,l;return e[10]!==s||e[11]!==t?(p=()=>t.on("visual-editing/mutate",async i=>s.dataRequest("mutate",i,{visibility:"async",returnDocuments:!0})),l=[s,t],e[10]=s,e[11]=t,e[12]=p,e[13]=l):(p=e[12],l=e[13]),f.useEffect(p,l),null};var z=f.memo(T);function x(n){return n.type==="welcome"||n.type==="reconnect"||n.type==="mutation"}function A(n){return n.type==="welcome"}function C(n){return n.type==="reconnect"}function V(n){return n.type==="mutation"}export{z as default};
